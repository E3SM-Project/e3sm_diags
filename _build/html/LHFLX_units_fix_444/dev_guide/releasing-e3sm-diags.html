

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How to Prepare a Release &mdash; E3SM Diags  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing to E3SM Diags" href="../contributing.html" />
    <link rel="prev" title="How to use the CDP Output Viewer" href="using-cdp-output-viewer.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> E3SM Diags
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">E3SM Diagnostics Package v2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input-data-requirement.html">Input Data Requirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickguides/index.html">Quick Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config-run.html">Configuration and Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="../defining-parameters.html">Defining Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../available-parameters.html">Available Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../colormaps.html">Colormaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../add-new-diagnostics.html">How to Add New Diagnostics Runs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="project-standards.html">Project Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing E3SM Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding-new-diags-sets.html">How to Add Diagnostic Sets to E3SM Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="using-cdp-output-viewer.html">How to use the CDP Output Viewer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to Prepare a Release</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparing-the-code-for-release">Preparing The Code For Release</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-release-on-github">Creating A Release On GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-the-sha256">Updating The sha256</a></li>
<li class="toctree-l3"><a class="reference internal" href="#releasing-the-software-on-anaconda">Releasing The Software On Anaconda</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-new-version-of-the-documentation">Creating a New Version of the Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-build-and-release-the-docker-image">How To Build and Release The Docker Image</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building">Building</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to E3SM Diags</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">E3SM Diags</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>How to Prepare a Release</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/dev_guide/releasing-e3sm-diags.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-prepare-a-release">
<span id="prepare-release"></span><h1>How to Prepare a Release<a class="headerlink" href="#how-to-prepare-a-release" title="Permalink to this headline">¶</a></h1>
<p>In this guide, we’ll cover:</p>
<ul class="simple">
<li><p>preparing the code for a release</p></li>
<li><p>releasing the code on Github</p></li>
<li><p>updating the sha256</p></li>
<li><p>releasing the software on Anaconda</p></li>
<li><p>creating a new version of the documentation</p></li>
<li><p>building and releasing the Docker image</p></li>
</ul>
<div class="section" id="preparing-the-code-for-release">
<h2>Preparing The Code For Release<a class="headerlink" href="#preparing-the-code-for-release" title="Permalink to this headline">¶</a></h2>
<p>These steps entail modifying files before a release is made.</p>
<p>1. Pull the lastest code from whatever branch you want to release from.
It’s usually <code class="docutils literal notranslate"><span class="pre">master</span></code>.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">fetch</span> <span class="o">&lt;</span><span class="n">upstream</span><span class="o">-</span><span class="n">origin</span><span class="o">&gt;</span> <span class="n">master</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">upstream</span><span class="o">-</span><span class="n">origin</span><span class="o">&gt;/</span><span class="n">master</span>
</pre></div>
</div>
</div></blockquote>
<p>2. Edit the <code class="docutils literal notranslate"><span class="pre">version</span></code> argument in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> to the new version.
Don’t prefix this with a “v”.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e3sm_diags&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.1.0&quot;</span><span class="p">,</span>  <span class="c1"># Change this line.</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Chengzhu (Jill) Zhang, Zeshawn Shaheen&quot;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s2">&quot;zhang40@llnl.gov, shaheen2@llnl.gov&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;E3SM Diagnostics&quot;</span><span class="p">,</span>
    <span class="n">scripts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;acme_diags/acme_diags_driver.py&quot;</span><span class="p">],</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*.test&quot;</span><span class="p">,</span> <span class="s2">&quot;*.test.*&quot;</span><span class="p">,</span> <span class="s2">&quot;test.*&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]),</span>
    <span class="n">data_files</span><span class="o">=</span><span class="n">data_files</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;e3sm_diags=acme_diags.acme_diags_driver:main&#39;</span><span class="p">,</span>
            <span class="s1">&#39;acme_diags=acme_diags.acme_diags_driver:main&#39;</span>
    <span class="p">]}</span>
<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="3">
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">version</span></code> label in the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> as well.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">label</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.1.0&quot;</span>  <span class="c1"># Change this line.</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>4. Edit <code class="docutils literal notranslate"><span class="pre">__version__</span></code> in <code class="docutils literal notranslate"><span class="pre">acme_diags/__init__.py</span></code>.
We use <code class="docutils literal notranslate"><span class="pre">__version__</span></code> when generating the webpages.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;v1.1.0&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>5. Change the <code class="docutils literal notranslate"><span class="pre">version</span></code> and <code class="docutils literal notranslate"><span class="pre">git_rev</span></code> tag in <code class="docutils literal notranslate"><span class="pre">conda/meta.yaml</span></code>.
<code class="docutils literal notranslate"><span class="pre">version</span></code> is what the version of the software will be on Anaconda and
<code class="docutils literal notranslate"><span class="pre">git_rev</span></code> is the tag that we’ll setup on GitHub in the next section.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>When running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code>, <code class="docutils literal notranslate"><span class="pre">conda</span></code> will download the code tagged by <code class="docutils literal notranslate"><span class="pre">git_rev</span></code>.
Even though <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> is in your local clone of the repo, running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span></code>
from here <strong>does not</strong> build the package based on your local code.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">e3sm_diags</span>
    <span class="n">version</span><span class="p">:</span> <span class="mf">1.1.0</span>

<span class="n">source</span><span class="p">:</span>
    <span class="n">git_url</span><span class="p">:</span> <span class="n">git</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">E3SM</span><span class="o">-</span><span class="n">Project</span><span class="o">/</span><span class="n">e3sm_diags</span>
    <span class="n">git_rev</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.1.0</span>
</pre></div>
</div>
</div></blockquote>
<p>6. Now in <code class="docutils literal notranslate"><span class="pre">conda/e3sm_diags_env.yml</span></code>, change the version of <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> under the
<code class="docutils literal notranslate"><span class="pre">dependencies</span></code> tag to whatever version is in the previous step.</p>
<p>We don’t need to edit anything in <code class="docutils literal notranslate"><span class="pre">conda/e3sm_diags_env_dev.yml</span></code> because there is no version
of <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> installed in the environment for that yml file.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span><span class="p">:</span>
<span class="o">-</span> <span class="n">e3sm_diags</span><span class="o">=</span><span class="mf">1.1.0</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="7">
<li><p>Commit and push your changes.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">am</span> <span class="s1">&#39;Changes before release.&#39;</span>
<span class="n">git</span> <span class="n">push</span> <span class="o">&lt;</span><span class="n">fork</span><span class="o">-</span><span class="n">origin</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Create a pull request to the main repo and merge it.</p></li>
</ol>
</div>
<div class="section" id="creating-a-release-on-github">
<span id="github-release"></span><h2>Creating A Release On GitHub<a class="headerlink" href="#creating-a-release-on-github" title="Permalink to this headline">¶</a></h2>
<p>1. Go to the Releases on the GitHub repo of the project
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/releases">here</a>.
and draft a new release.</p>
<p>2. <code class="docutils literal notranslate"><span class="pre">Tag</span> <span class="pre">version</span></code> and <code class="docutils literal notranslate"><span class="pre">Release</span> <span class="pre">title</span></code> should both be the version, including the “v”.
(They should match <code class="docutils literal notranslate"><span class="pre">git_rev</span></code> in step 5 of the previous section).
<code class="docutils literal notranslate"><span class="pre">Target</span></code> should be <code class="docutils literal notranslate"><span class="pre">master</span></code>. Use <code class="docutils literal notranslate"><span class="pre">Describe</span> <span class="pre">this</span> <span class="pre">release</span></code> to write what features
the release adds. You can scroll through
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/commits/master">E3SM Diags commits</a> to see
what features have been added recently.</p>
<p>Note that you can also change the branch which you want to release from,
this is specified after the tag (&#64; Target: <code class="docutils literal notranslate"><span class="pre">master</span></code>).</p>
<p>The title of a release is often the same as the tag, but you can set it to whatever you want.</p>
<p>Remember to write a description.</p>
<div class="figure align-center" id="id3" style="width: 100%">
<a class="reference external image-reference" href="../_static/releasing-e3sm-diags/github_release.png"><img alt="../_images/github_release.png" src="../_images/github_release.png" /></a>
<p class="caption"><span class="caption-text">An example of a completed page to release the code</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<ol class="arabic simple" start="3">
<li><p>Click “Publish release”.</p></li>
</ol>
</div>
<div class="section" id="updating-the-sha256">
<h2>Updating The sha256<a class="headerlink" href="#updating-the-sha256" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Download “Source code (.tar.gz)” from the <a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/releases">GitHub releases page</a>.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">shasum</span> <span class="pre">-a</span> <span class="pre">256</span></code> on this file. For example:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shasum</span> <span class="o">-</span><span class="n">a</span> <span class="mi">256</span> <span class="n">e3sm_diags</span><span class="o">-</span><span class="mf">1.1.0</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>3. On your machine, pull the latest version of the code.
This will have the <code class="docutils literal notranslate"><span class="pre">conda/meta.yaml</span></code> we edited in the first section.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">fetch</span> <span class="o">&lt;</span><span class="n">upstream</span><span class="o">-</span><span class="n">origin</span><span class="o">&gt;</span> <span class="n">master</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">upstream</span><span class="o">-</span><span class="n">origin</span><span class="o">&gt;/</span><span class="n">master</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="4">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">sha256</span></code> in <code class="docutils literal notranslate"><span class="pre">conda/meta.yaml</span></code> to the result of step 2.</p></li>
<li><dl>
<dt>Commit and push your changes.</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">am</span> <span class="s1">&#39;Edit sha256 for v1.1.0&#39;</span>
<span class="n">git</span> <span class="n">push</span> <span class="o">&lt;</span><span class="n">fork</span><span class="o">-</span><span class="n">origin</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>Create a pull request to the main repo and merge it.</p></li>
</ol>
</div>
<div class="section" id="releasing-the-software-on-anaconda">
<h2>Releasing The Software On Anaconda<a class="headerlink" href="#releasing-the-software-on-anaconda" title="Permalink to this headline">¶</a></h2>
<p>1. Be sure to have already completed <a class="reference internal" href="#github-release"><span class="std std-ref">Creating A Release On GitHub</span></a>.
This triggers the CI/CD workflow that handles Anaconda releases.</p>
<p>2. Wait until the CI/CD build is successful. You can view all workflows at
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/actions">All Workflows</a>.</p>
<ol class="arabic simple" start="3">
<li><p>Check the <a class="reference external" href="https://anaconda.org/e3sm/e3sm_diags">https://anaconda.org/e3sm/e3sm_diags</a> page to view the newly updated package.</p></li>
</ol>
<p>4. Notify the maintainers of the unified E3SM environment about the new release on the
<a class="reference external" href="https://acme-climate.atlassian.net/wiki/spaces/WORKFLOW/pages/129732419/E3SM+Unified+Anaconda+Environment">E3SM Confluence site</a>.
Be sure to only update the <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> version number in the correct version(s) of
the E3SM Unified environment. This is almost certainly one of the versions listed under
“Next versions”. If you are uncertain of which to update, leave a comment on the page
asking.</p>
</div>
<div class="section" id="creating-a-new-version-of-the-documentation">
<h2>Creating a New Version of the Documentation<a class="headerlink" href="#creating-a-new-version-of-the-documentation" title="Permalink to this headline">¶</a></h2>
<p>1. Be sure to have already completed <a class="reference internal" href="#github-release"><span class="std std-ref">Creating A Release On GitHub</span></a>.
This triggers the CI/CD workflow that handles publishing documentation versions.</p>
<p>2. Wait until the CI/CD build is successful. You can view all workflows at
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/actions">All Workflows</a>.</p>
<p>3. Changes will be available on the
<a class="reference external" href="https://e3sm-project.github.io/e3sm_diags/">e3sm_diags documentation page</a>.</p>
</div>
<div class="section" id="how-to-build-and-release-the-docker-image">
<h2>How To Build and Release The Docker Image<a class="headerlink" href="#how-to-build-and-release-the-docker-image" title="Permalink to this headline">¶</a></h2>
<p>A Docker image of <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> needs to be created and released as well.
This Docker image can be ran as a container via Docker, Shifter, or Singularity.</p>
<p>We’ll build the image, test it, and then release it.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>1. Please make a Docker ID if you haven’t done so already.
This is needed to release and upload the image.</p>
<p>2. Also make sure that you have access to the <a class="reference external" href="https://hub.docker.com/u/e3sm">e3sm Dockerhub</a> ,
and specifically the e3sm_diags repo there. If you don’t, you’ll see an error when you run
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">push</span></code> later on in this guide.
Email Jill Zhang (<a class="reference external" href="mailto:zhang40&#37;&#52;&#48;llnl&#46;gov">zhang40<span>&#64;</span>llnl<span>&#46;</span>gov</a>) or Rob Jacob (<a class="reference external" href="mailto:jacob&#37;&#52;&#48;anl&#46;gov">jacob<span>&#64;</span>anl<span>&#46;</span>gov</a>) for access.</p>
</div>
<div class="section" id="building">
<h3>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h3>
<ol class="arabic" start="3">
<li><p>Set an environmental variable, <code class="docutils literal notranslate"><span class="pre">E3SM_DIAGS_VERSION</span></code>, to the version that you’re releasing.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">E3SM_DIAGS_VERSION</span><span class="o">=</span><span class="n">v1</span><span class="mf">.5.0</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<div class="section" id="a-temporary-diversion">
<h4>A Temporary Diversion<a class="headerlink" href="#a-temporary-diversion" title="Permalink to this headline">¶</a></h4>
<p>4. When installing the software, a user needs to do <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span> <span class="pre">.</span></code>
instead of the traditional <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code>.
It’s the way Anaconda recommends creating packages.
This is <em>currently</em> causing issues when building the Docker image.
Due to this, open <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> and change the <code class="docutils literal notranslate"><span class="pre">INSTALL_PATH</span></code> to be <code class="docutils literal notranslate"><span class="pre">os.path.join(sys.prefix,</span> <span class="pre">'share/e3sm_diags/')</span></code>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># INSTALL_PATH = &#39;share/e3sm_diags/&#39;</span>
<span class="n">INSTALL_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="s1">&#39;share/e3sm_diags/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="5">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> and change any instance of <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span> <span class="pre">.</span></code> to <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></code>.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RUN</span> <span class="n">conda</span> <span class="n">env</span> <span class="n">update</span> <span class="o">-</span><span class="n">n</span> <span class="n">base</span> <span class="o">--</span><span class="n">file</span> <span class="n">conda</span><span class="o">/</span><span class="n">e3sm_diags_env_dev</span><span class="o">.</span><span class="n">yml</span> <span class="o">&amp;&amp;</span> \
        <span class="n">conda</span> <span class="n">clean</span> <span class="o">--</span><span class="nb">all</span> <span class="o">-</span><span class="n">y</span> <span class="o">&amp;&amp;</span> \
        <span class="n">source</span> <span class="n">activate</span> <span class="n">base</span> <span class="o">&amp;&amp;</span> \
        <span class="c1"># pip install --user . &amp;&amp; \</span>
        <span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span> <span class="o">&amp;&amp;</span> \
        <span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="n">build</span><span class="o">/</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="back-to-building-the-image">
<h4>Back to Building the Image<a class="headerlink" href="#back-to-building-the-image" title="Permalink to this headline">¶</a></h4>
<p>6. Go to the root of the project, where the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> is located and run the command below.
This builds the image and adds two tags, one titled <code class="docutils literal notranslate"><span class="pre">latest</span></code> and one based on the version you’re releasing.
By prefixing the tag with <code class="docutils literal notranslate"><span class="pre">e3sm/</span></code>, it’ll upload it to the
<a class="reference external" href="https://hub.docker.com/u/e3sm">e3sm Dockerhub</a>,
which we’ll do in forthcoming steps.</p>
<p>When Docker builds an image, it sends all of the data in the current working directory as the build context.
So if the current directory has a lot of data (like sample runs, large nc files, etc),
remove them before continuing.
Check the size of the current directory with <code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-sh</span> <span class="pre">.</span></code>.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker build . -t e3sm/e3sm_diags:latest -t e3sm/e3sm_diags:$E3SM_DIAGS_VERSION
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="7">
<li><p>View the Docker images you have. You should see the images you’ve made, based on the tags.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">images</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>You should see something like this:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">REPOSITORY</span>               <span class="n">TAG</span>                 <span class="n">IMAGE</span> <span class="n">ID</span>            <span class="n">CREATED</span>             <span class="n">SIZE</span>
<span class="n">e3sm</span><span class="o">/</span><span class="n">e3sm_diags</span>          <span class="n">latest</span>              <span class="n">bc7f93375025</span>        <span class="mi">6</span> <span class="n">minutes</span> <span class="n">ago</span>       <span class="mf">3.57</span><span class="n">GB</span>
<span class="n">e3sm</span><span class="o">/</span><span class="n">e3sm_diags</span>          <span class="n">v1</span><span class="mf">.5.0</span>              <span class="n">bc7f93375025</span>        <span class="mi">6</span> <span class="n">minutes</span> <span class="n">ago</span>       <span class="mf">3.57</span><span class="n">GB</span>
<span class="n">continuumio</span><span class="o">/</span><span class="n">miniconda</span>    <span class="mf">4.5.4</span>               <span class="mf">16e4</span><span class="n">fbac86ce</span>        <span class="mi">7</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mi">544</span><span class="n">MB</span>
<span class="n">hello</span><span class="o">-</span><span class="n">world</span>              <span class="n">latest</span>              <span class="n">e38bc07ac18e</span>        <span class="mi">5</span> <span class="n">months</span> <span class="n">ago</span>        <span class="mf">1.85</span><span class="n">kB</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="testing">
<h4>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h4>
<ol class="arabic" start="8">
<li><p>Go to the folder with the system tests.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">tests</span><span class="o">/</span><span class="n">system</span><span class="o">/</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>9. <code class="docutils literal notranslate"><span class="pre">wget</span></code> or <code class="docutils literal notranslate"><span class="pre">curl</span></code> the script to run the image.
When you actually run an image, it’s called a <strong>container</strong>.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">E3SM</span><span class="o">-</span><span class="n">Project</span><span class="o">/</span><span class="n">e3sm_diags</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">acme_diags</span><span class="o">/</span><span class="n">container</span><span class="o">/</span><span class="n">e3sm_diags_container</span><span class="o">.</span><span class="n">py</span>

<span class="c1"># Or use this:</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">O</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">E3SM</span><span class="o">-</span><span class="n">Project</span><span class="o">/</span><span class="n">e3sm_diags</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">acme_diags</span><span class="o">/</span><span class="n">container</span><span class="o">/</span><span class="n">e3sm_diags_container</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div></blockquote>
<p>10. Run the tests. Check the terminal and
results after each run to ensure that everything was created without errors.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">e3sm_diags_container</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">docker</span> <span class="o">-</span><span class="n">p</span> <span class="n">all_sets</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">d</span> <span class="n">all_sets</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
</div></blockquote>
<p>11. If you do find an error, it could be with the script <code class="docutils literal notranslate"><span class="pre">e3sm_diags_container.py</span></code> or with <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> itself.
Please fix this. You might need to delete the release, or release a bug-fix version.</p>
</div>
<div class="section" id="releasing">
<h4>Releasing<a class="headerlink" href="#releasing" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple" start="12">
<li><p>Push both of the images, one with the <code class="docutils literal notranslate"><span class="pre">latest</span></code> tag and the other with the version you’re releasing.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker push e3sm/e3sm_diags:latest
docker push e3sm/e3sm_diags:$E3SM_DIAGS_VERSION
</pre></div>
</div>
<ol class="arabic simple" start="13">
<li><p>Congratulations, you’re done! You can go home/nap for the day, I won’t tell.</p></li>
</ol>
</div>
<div class="section" id="optional-cleanup">
<h4>Optional: Cleanup<a class="headerlink" href="#optional-cleanup" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>These images can take up a fair amount of space on your machine, since each is around 4GB.
Here are some ways to manage them.</p>
<ul>
<li><p>View all of the images you have with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images</span></code>.
You can remove an image by the image id.
The <code class="docutils literal notranslate"><span class="pre">--force</span></code> option is also supported.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rmi</span> <span class="o">&lt;</span><span class="n">image_id</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Run the command below once in a while to remove unused data.
This includes any intermediate or broken images/container.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">system</span> <span class="n">prune</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../contributing.html" class="btn btn-neutral float-right" title="Contributing to E3SM Diags" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="using-cdp-output-viewer.html" class="btn btn-neutral float-left" title="How to use the CDP Output Viewer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, E3SM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: LHFLX_units_fix_444
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../v2.5.0/dev_guide/releasing-e3sm-diags.html">v2.5.0</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../master/dev_guide/releasing-e3sm-diags.html">master</a></dd>
      <dd><a href="releasing-e3sm-diags.html">LHFLX_units_fix_444</a></dd>
      <dd><a href="../../fix_O3_obs/dev_guide/releasing-e3sm-diags.html">fix_O3_obs</a></dd>
      <dd><a href="../../fix_save_netcdf_diurnal_cycle_iss448/dev_guide/releasing-e3sm-diags.html">fix_save_netcdf_diurnal_cycle_iss448</a></dd>
      <dd><a href="../../single_sites_extraction/dev_guide/releasing-e3sm-diags.html">single_sites_extraction</a></dd>
      <dd><a href="../../update_load_e3sm_unified/dev_guide/releasing-e3sm-diags.html">update_load_e3sm_unified</a></dd>
      <dd><a href="../../v2.3.0_v2.4.0_docs/dev_guide/releasing-e3sm-diags.html">v2.3.0_v2.4.0_docs</a></dd>
    </dl>
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>